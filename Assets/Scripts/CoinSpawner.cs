using UnityEngine;
using System.Collections;

public class CoinSpawner : MonoBehaviour
{
    public GameObject coinPrefab;
    public int coinsPerPlayer = 50;
    public float spacing = 2f;
    public int coinsPerRow = 10;

    void Start()
    {
        // ????? ??????? ????? ?????
        SpawnCoinsForPlayer(1, new Vector3(0f, 0f, 0f));

        // ????? ??????? ????? ?????? (????? ??? ??? 30 ???? ?? ??????? X)
        SpawnCoinsForPlayer(2, new Vector3(30f, 0f, 0f));

        // ??? ????????? ???? ????? ???? ????? ????????
        StartCoroutine(SpawnCoinCoroutine());
    }

    void SpawnCoinsForPlayer(int playerId, Vector3 startPosition)
    {
        for (int i = 0; i < coinsPerPlayer; i++)
        {
            int row = i / coinsPerRow;
            int column = i % coinsPerRow;

            Vector3 position = new Vector3(
                startPosition.x + column * spacing,
                startPosition.y,
                startPosition.z + row * spacing
            );

            Instantiate(coinPrefab, position, Quaternion.identity);
        }
    }

    IEnumerator SpawnCoinCoroutine()
    {
        while (true)
        {
            // ?????? ???? ?????? ????? ???? ????
            int randomIndex = Random.Range(0, 3);
            float xValue = 0f;

            if (randomIndex == 0)
                xValue = -30f;
            else if (randomIndex == 1)
                xValue = 0f;
            else if (randomIndex == 2)
                xValue = 30f;

            // ??? ?????? ??? ?????? ??????
            float delay = Random.Range(1f, 5f);
            yield return new WaitForSeconds(delay);

            // ????? ??????
            StartCoroutine(SpawnCoin(xValue));
        }
    }

    IEnumerator SpawnCoin(float xValue)
    {
        yield return null; // ?? ???? ????? ???? ???? ????? Wait ???

        Instantiate(coinPrefab, new Vector3(xValue, -0.13f, 361.6f), Quaternion.identity);
    }
}
